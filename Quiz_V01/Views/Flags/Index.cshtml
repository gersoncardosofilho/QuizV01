@model FlagViewModel
@using System.Diagnostics
@using Newtonsoft.Json
@using Quiz_V01.Models

<script src="@Url.Content("~/Scripts/jquery-3.0.0.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.js")" type="text/javascript"></script>

<meta charset="UTF-8" />


@section scripts
{
<script>

        var counter = @Model.AllFlags.Count;
        var currentFlagName = '@Html.Raw(@Model.flag.FlagName)';
        var flagsCollection = @Html.Raw(Json.Encode(@Model.AllFlags));

        $(document).ready(function() {

            $(".box").click(function() {
                var resposta = $(this).children().text();
                console.log(resposta);

                if (counter > 0) {
                    console.log("valor do contador: " + counter);
                    console.log("ainda precisa verificar a resposta");
                    console.log("nome bandeira corrente: " + currentFlagName);
                    console.log("resposta: " + resposta);

                    avaliarResposta(currentFlagName, resposta, flagsCollection);

                }

                //VerificaResposta();
            });

            function avaliarResposta(currentFlagName, resposta, flagsCollection) {
                console.log("resposta atual:" + resposta);
                console.log("flag atual: " + currentFlagName);
                console.log("current collection" + flagsCollection);

                var url = "/Flags/CheckResponse";

                $.post(url,
                    {
                        currentFlagName: currentFlagName,
                        response: resposta,
                        currentCollection: flagsCollection
                    },
                    function(data) {
                        remontaPagina(data);

                    }
                );
            }

            function remontaPagina(data) {
                var obj = JSON && JSON.parse(data) || $.parseJSON(data);
                console.log("resposta" + obj.AnswerCheck);
                console.log("flag: " + obj.flag.FlagName);

                $('#lblCounter').html("Restam " + obj.AllFlags.length + " questões");
                flagsCollection = obj.AllFlags;



            }


            function resultadoQuiz() {
                window.location.href = '@Url.Action("Index", "Results")';
            };
        });

</script>
}


@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var currentFlag = @Model.flag;
    var allFlags = @Model.AllFlags;
    var questionArray = @Model.FlagsToQuestion.ToList();

}

<style>
    .box {
        background-color: cornflowerblue;
        width: 300px;
        height: 50px;
        margin-top: 20px;
        margin-bottom: 20px;
        padding: 10px;
    }
</style>


<div class="container" style="margin-top: 50px">
    
    <div class="row" style="margin-bottom: 30px">
        <div class="col-md-12">
            <h2 class="text-center" id="lblCounter">Restam @allFlags.Count questões</h2>
        </div>
        
    </div>

    <div class="row">
        <div class="col-md-1"></div>

        <div class="col-md-4">
            <img src="@Url.Content(@currentFlag.FlagUrl)" width="200" height="auto" />
        </div>

        <div class="col-md-6">

            @foreach (var name in questionArray)
            {
                <div class="box">
                    <p id="idText">@name</p>
                </div>
            }

            <h3 id="lblResposta"></h3>

        </div>

        <div class="col-md-1"></div>
    </div>

</div>

<div class="text-center">@Html.ActionLink("Reiniciar", "Index", "Flags")</div>




